<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>幸运转盘抽奖</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #fdebd3;
      font-family: "Microsoft YaHei", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }
    .wheel-container {
      position: relative;
      width: 90vw;
      max-width: 400px;
      aspect-ratio: 1 / 1; /* 确保是正方形 */
    }
    canvas {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 8px solid #fff;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      transform: rotate(0deg);
    }
    .pointer {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 80px;
      height: 80px;
      margin-left: -40px;
      margin-top: -40px;
      background: #ff4e9b;
      border-radius: 50%;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 18px;
      cursor: pointer;
      z-index: 10;
      box-shadow: 0 0 8px rgba(0,0,0,0.3);
      user-select: none;
    }
    #result {
      margin-top: 20px;
      font-size: 20px;
      color: #d35400;
      font-weight: bold;
    }
    /* 音乐按钮 */
    #musicBtn {
      margin-top: 15px;
      padding: 8px 16px;
      background: #27ae60;
      color: #fff;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="wheel-container">
    <canvas id="wheel"></canvas>
    <div class="pointer" onclick="spin()">立即抽奖</div>
  </div>
  <div id="result"></div>

  <!-- 背景音乐 -->
  <audio id="bgm" src="In_your_eyes.mp3" loop></audio>
  <button id="musicBtn" onclick="toggleMusic()">开启音乐</button>

  <script>
    // 奖品和对应概率
    const prizes = [
      { name: "奶茶", weight: 50 },   
      { name: "甜品", weight: 25 },    
      { name: "学游泳", weight: 8 },  
      { name: "MASSAGE", weight: 15 },  
      { name: "去宁波", weight: 3 },  
      { name: "去看星星", weight: 6 }
    ];
    const colors = ["#ffe0e9", "#fffacd", "#e0f7fa", "#e1bee7", "#c8e6c9", "#ffccbc"];

    let canvas = document.getElementById("wheel");
    let ctx = canvas.getContext("2d");
    let size = canvas.width = canvas.height = 400; // 固定画布大小
    let arc = 2 * Math.PI / prizes.length;
    let spinning = false;

    // 绘制转盘
    function drawWheel() {
      for (let i = 0; i < prizes.length; i++) {
        ctx.beginPath();
        ctx.fillStyle = colors[i % colors.length];
        ctx.moveTo(size/2, size/2);
        ctx.arc(size/2, size/2, size/2, arc*i, arc*(i+1));
        ctx.fill();
        ctx.save();

        // 写文字
        ctx.translate(size/2, size/2);
        ctx.rotate(arc*i + arc/2);
        ctx.textAlign = "right";
        ctx.fillStyle = "#333";
        ctx.font = "16px sans-serif";
        ctx.fillText(prizes[i].name, size/2 - 10, 5);
        ctx.restore();
      }
    }
    drawWheel();

    // 根据权重选择奖品
    function weightedRandom() {
      const totalWeight = prizes.reduce((sum, prize) => sum + prize.weight, 0);
      let random = Math.random() * totalWeight;
      for (let i = 0; i < prizes.length; i++) {
        if (random < prizes[i].weight) {
          return i;
        }
        random -= prizes[i].weight;
      }
      return prizes.length - 1;
    }

    function spin() {
      if (spinning) return;
      spinning = true;

      let prizeIndex = weightedRandom();
      let spins = Math.floor(Math.random() * 3) + 4;
      let finalAngle = 360 * spins - (prizeIndex * (360 / prizes.length) + 360/(2*prizes.length));

      canvas.style.transition = "transform 4s ease-out";
      canvas.style.transform = `rotate(${finalAngle}deg)`;

      setTimeout(() => {
        document.getElementById("result").innerText = "抽中：" + prizes[prizeIndex].name;
        spinning = false;

        // 重置角度
        canvas.style.transition = "none";
        canvas.style.transform = `rotate(${-prizeIndex * (360/prizes.length)}deg)`;
      }, 4200);
    }

    // 音乐控制
    function toggleMusic() {
      const bgm = document.getElementById("bgm");
      if (bgm.paused) {
        bgm.play();
        document.getElementById("musicBtn").innerText = "关闭音乐";
      } else {
        bgm.pause();
        document.getElementById("musicBtn").innerText = "开启音乐";
      }
    }
  </script>
</body>
</html>

